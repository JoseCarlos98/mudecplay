<div class="card-content shadow-md">
  <app-module-header title="Gastos" [config]="headerConfig" (action)="onHeaderAction($event)">
  </app-module-header>

  <form [formGroup]="formFilters">
    <div class="c-filters grid grid-cols-2 sm:grid-cols-5 lg:grid-cols-6">
      <div class="c-input">
        <p class="label">Rango de fecha</p>

        <mat-form-field appearance="outline" class="w-100">
          <mat-date-range-input [rangePicker]="picker">
            <input formControlName="startDate" matStartDate placeholder="Inicio">
            <input formControlName="endDate" matEndDate placeholder="Fin">
          </mat-date-range-input>

          @if (formFilters.value.startDate || formFilters.value.endDate) {
          <button type="button" mat-icon-button matSuffix aria-label="Limpiar rango" (click)="clearAndOpen()">
            <mat-icon class="color-third">close</mat-icon>
          </button>
          } @else {
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          }
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
      </div>

      <app-autocomplete-multiple formControlName="suppliersIds" label="Proveedores" placeholder="Todos" [remote]="true"
        catalogType="supplier">
      </app-autocomplete-multiple>

      <app-autocomplete-multiple formControlName="projectIds" label="Proyectos" placeholder="Todos" [remote]="true"
        catalogType="project">
      </app-autocomplete-multiple>

      <div class="c-input">
        <p>Estado de asignaci√≥n</p>
        <mat-form-field appearance="outline" class="w-100"
          [ngClass]="{ 'padding-selection-select' : formFilters.get('status_id')?.value  }">
          <mat-select #statusSel="matSelect" formControlName="status_id">
            <mat-option value="">Todos</mat-option>
            @for (data of catalogStatusExpense; track data.id) {
            <mat-option [value]="data.id">{{ data.name }}</mat-option>
            }
          </mat-select>
          @if (formFilters.get('status_id')?.value) {
          <button type="button" matSuffix mat-icon-button [disableRipple]="true"
            (mousedown)="$event.preventDefault(); $event.stopPropagation()"
            (click)="$event.stopPropagation(); clearInput('statusId'); statusSel.close()" aria-label="Limpiar estado">
            <mat-icon matSuffix (click)="clearInput('statusId')" class="cursor-pointer color-third">close</mat-icon>
          </button>
          }
        </mat-form-field>
      </div>

      <div class="c-input">
        <p>Concepto</p>
        <mat-form-field appearance="outline" class="w-100">
          <input placeholder="Buscar por concepto" formControlName="concept" matInput />

          @if (formFilters.get('concept')?.value?.trim()) {
          <button type="button" matSuffix mat-icon-button>
            <mat-icon matSuffix (click)="clearInput('concept')" class="cursor-pointer color-third">close</mat-icon>
          </button>
          }
        </mat-form-field>
      </div>

      <div class="btns-action-filters">
        <button type="button" class="btn-primary" (click)="searchWithFilters()">
          <mat-icon>search</mat-icon>
        </button>

        <button type="button" class="btn-outline" (click)="clearAllAndSearch()" [disabled]="!hasActiveFilters">
          Limpiar
        </button>
      </div>

    </div>
  </form>
</div>

@if (expensesTableData?.data) {
<div class="c-module-table">
  <app-data-table [data]="expensesTableData.data" [columnsConfig]="columnsConfig" [displayedColumns]="displayedColumns"
    (edit)="onEdit($event)" (delete)="onDelete($event)">
  </app-data-table>

  <mat-paginator [length]="expensesTableData.meta.total" [pageSize]="filters.limit" [pageIndex]="filters.page - 1"
    [pageSizeOptions]="[5, 10, 25, 50]" (page)="onPageChange($event)" showFirstLastButtons>
  </mat-paginator>
</div>
}