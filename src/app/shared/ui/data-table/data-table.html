<div class="table-container">
  <div class="overflow-x-auto">
    <table mat-table [dataSource]="dataSource" class="border-collapse">

      <!-- Columnas dinámicas -->
      @for (col of columnsConfig; track col.key) {
        <ng-container [matColumnDef]="col.key">
          <th mat-header-cell *matHeaderCellDef class="text-left">
            {{ col.label }}
          </th>

          <td mat-cell *matCellDef="let element"
              [class.text-right]="col.align === 'right'"
              [class.text-center]="col.align === 'center'">
            @switch (col.type) {
              @case ('relation') {
                @let rel = getRelationValue(element[col.key], col.path);

                @if (rel) {
                  <!-- Hay valor en la relación -->
                  @if (col.typeVariant) {
                    <span
                      class="table-chip"
                      [ngClass]="{
                        'table-chip-success': col.typeVariant === 'chip-success',
                        'table-chip-warning': col.typeVariant === 'chip-warning',
                        'table-chip-neutral': col.typeVariant === 'chip-neutral'
                      }">
                      {{ rel }}
                    </span>
                  } @else {
                    <!-- Sin variant => texto normal -->
                    {{ rel }}
                  }
                } @else {
                  <!-- No hay valor: fallback -->
                  @if (col.fallbackVariant) {
                    <span
                      class="table-chip"
                      [ngClass]="{
                        'table-chip-success': col.fallbackVariant === 'chip-success',
                        'table-chip-warning': col.fallbackVariant === 'chip-warning',
                        'table-chip-neutral': col.fallbackVariant === 'chip-neutral'
                      }">
                      {{ col.fallback ?? '' }}
                    </span>
                  } @else {
                    {{ col.fallback ?? '' }}
                  }
                }
              }
              @case ('money') {
                {{ element[col.key] | currency:'$ ':'symbol':'1.2-2' }}
              }
              @case ('date') {
                {{ element[col.key] | date:"d MMM y" : 'es-MX' }}
              }
              @case ('showItems') {
                <button type="button" class="btn-view-row" (click)="onRowAction('showItems', element)">
                  <mat-icon>visibility</mat-icon>
                  <span>Ver</span>
                </button>
              }
              @default {
                {{ element[col.key] ?? col.fallback ?? '' }}
              }
            }
          </td>
        </ng-container>
      }

      <!-- Columna de acciones -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="text-center">Acciones</th>
        <td mat-cell *matCellDef="let element" class="c-actions-cells">
          <div>
            <button
              mat-icon-button
              class="edit-btn"
              (click)="onRowAction('edit', element)">
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              class="delete-btn"
              (click)="onRowAction('delete', element)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" class="hover:bg-gray-100 transition-all duration-200">
      </tr>
    </table>
  </div>
</div>
